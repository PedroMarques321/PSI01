<div class="gestor-container">
  <button (click)="mostrarLista()">Mostrar Táxis</button>

  <div *ngIf="loading">A carregar táxis...</div>
  <div *ngIf="errorMessage">{{ errorMessage }}</div>

  <div *ngIf="mostrarTaxis">
    <h3>Lista de Táxis</h3>
    <ul>
      <li *ngFor="let taxi of listaTaxis" class="taxi-item">
        <strong>{{ taxi.modelo }} ({{ taxi.marca }})</strong>
        Matrícula: {{ taxi.matricula }}<br>
        <button (click)="editarTaxi(taxi)">Editar</button>
        <button *ngIf="!taxi.requesitado" (click)="removerTaxi(taxi._id!)">Remover</button>
      </li>
    </ul>

    <!-- Formulário de Edição -->
    <div *ngIf="mostrarEditorTaxi && taxiAEditar" class="editor-form">
      <h3>Editar Táxi</h3>

      <!-- Matrícula -->
      <div>
        <label for="matricula">Matrícula:</label>
        <mat-form-field class="matricula" appearance="outline">
          <input
            matInput
            type="text"
            id="matricula"
            name="matricula"
            [(ngModel)]="taxiAEditar.matricula"
            required
          />
        </mat-form-field>
      </div>
      <div *ngIf="!validarMatricula(taxiAEditar.matricula)" style="color: red;">
        Matrícula inválida!
      </div>

      <!-- Marca -->
      <div>
        <label for="marca">Marca:</label>
        <select id="marca" name="marca" [(ngModel)]="taxiAEditar.marca" (change)="atualizarModelos()" required>
          <option value="" disabled>-- Escolhe a marca --</option>
          <option *ngFor="let marca of marcasDisponiveis" [value]="marca">{{ marca }}</option>
        </select>
      </div>

      <!-- Modelo -->
      <div>
        <label for="modelo">Modelo:</label>
        <select id="modelo" name="modelo" [(ngModel)]="taxiAEditar.modelo" [disabled]="!modelosDisponiveis.length" required>
          <option value="" disabled>-- Escolhe o modelo --</option>
          <option *ngFor="let modelo of modelosDisponiveis" [value]="modelo">{{ modelo }}</option>
        </select>
      </div>

      <!-- Ano de Compra -->
      <div>
        <label for="anoCompra">Ano de Compra:</label>
        <input
          type="date"
          id="anoCompra"
          name="anoCompra"
          [(ngModel)]="taxiAEditar.ano_de_compra"
          required
        />
      </div>
      <div *ngIf="!validarData(taxiAEditar.ano_de_compra, 0)" style="color: red;">
        A data de compra não pode ser superior à data atual.
      </div>

      <!-- Nível de Conforto -->
      <div *ngIf="taxiAEditar.usado === false">
        <label for="conforto">Nível de Conforto (RIA 16):</label>
        <select
          id="conforto"
          name="conforto"
          [(ngModel)]="taxiAEditar.conforto"
          required
        >
          <option value="Muito Confortável">Muito Confortável</option>
          <option value="Normal">Normal</option>
        </select>
      </div>

      <!-- Número de Lugares -->
      <div>
        <label for="lugares">Número de Lugares:</label>
        <input type="number" id="lugares" name="lugares" [(ngModel)]="taxiAEditar.lugares" required>
      </div>

      <!-- Botões -->
      <div class="editor-buttons">
        <button (click)="guardarEdicao()">Guardar Alterações</button>
        <button (click)="cancelarEdicao()">Cancelar</button>
      </div>
    </div>

  </div>
</div>

